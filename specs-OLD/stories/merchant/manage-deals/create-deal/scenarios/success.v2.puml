@startuml Create_Deal_Success_v2
title Create Deal - Success Scenario (BFF-Orchestrated)

actor User
participant "Web App (UI)\nSvelteKit +page.svelte" as UI
participant "BFF API\n+server.ts (/api/deals)" as BFF
participant "Auth\n(JWT verification)" as Auth
participant "Deals MS\n(Lambda/API - private)" as MS
database "Deals DB\n(DynamoDB)" as DB

User -> UI: Fill form and submit
UI -> BFF: POST /api/deals {payload}
activate BFF

BFF -> Auth: Verify JWT (bearer)
Auth --> BFF: OK (claims)

BFF -> BFF: Validate request schema\n(DealCreateRequest)
BFF -> BFF: Enrich from JWT (merchantId if applicable)\nCompute/normalize fields

BFF -> MS: CreateDeal(payload)
activate MS

MS -> MS: Domain validation\nCompute finalPrice
MS -> DB: PutItem (Deal)
DB --> MS: OK
MS --> BFF: 201 {Deal}

deactivate MS

BFF -> BFF: Map to API response\nSet Location header
BFF --> UI: 201 {Deal}
deactivate BFF

UI --> User: Show success\n(Deal created)

@enduml
